<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <title>Gitflow Interactive</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --primary: #6366f1;
      --secondary: #3b82f6;
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #eab308;
      --background: #0f172a;
      --surface: #1e293b;
      --text: #f8fafc;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(45deg, var(--background), #1a2333);
      color: var(--text);
      min-height: 100vh;
      overflow-x: auto;
    }

    .container {
      display: flex;
      gap: 2rem;
      padding: 2rem;
      margin: 2rem auto;
      width: fit-content;
      min-width: 90%;
      position: relative;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes drawLine {
      from { stroke-dashoffset: 1000; }
      to { stroke-dashoffset: 0; }
    }
    .svg-lines line.new-line {
      animation: drawLine 3s ease-out forwards;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
    }

    

    .branch-column {
      background: var(--surface);
      border-radius: 1rem;
      padding: 1.5rem;
      min-width: 240px;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      animation: fadeIn 0.5s ease-out;
    }

    .branch-column:hover {
      transform: translateY(-5px);
    }

    .branch-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
    }

    .branch-header::before {
      content: 'ğŸŒ¿';
      filter: brightness(1.2);
    }

    .commit-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      position: relative;
      min-height: 400px;
    }

    .commit-bubble {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.2);
    }

    .commit-bubble:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px var(--primary);
    }

    .commit-bubble.latest::after {
      content: 'âœ¨';
      position: absolute;
      right: -5px;
      top: -5px;
      font-size: 1.2rem;
    }

    .action-buttons {
      display: grid;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
    }

    button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    button.delete {
      background: linear-gradient(45deg, var(--danger), #dc2626);
    }

    button.success {
      background: linear-gradient(45deg, var(--success), #16a34a);
    }

    button.warning {
      background: linear-gradient(45deg, var(--warning), #ca8a04);
    }

    .svg-lines {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 999;
    }

    .log-container {
      background: var(--surface);
      border-radius: 1rem;
      margin: 2rem auto;
      padding: 1.5rem;
      width: 90%;
      max-width: 1200px;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
    }

    .log-entry {
      padding: 1rem;
      margin: 0.5rem 0;
      background: #2d3748;
      border-radius: 0.5rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

    .log-timestamp {
      color: #94a3b8;
      font-size: 0.9rem;
    }

    .log-content {
      flex-grow: 1;
    }

    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--surface);
      color: var(--text);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      white-space: nowrap;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.2);
    }
    .commit-bubble.feature-flag::after {
      content: 'ğŸš©';
      position: absolute;
      bottom: -5px;
      right: -5px;
      font-size: 0.8em;
      background: var(--surface);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      animation: pulse 1.5s infinite;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        width: 95%;
      }
      .branch-column {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <div ref="container" class="container">
    <svg class="svg-lines" :width="svgWidth" :height="svgHeight">
      <line
  v-for="(line, index) in lines"
  :key="`line-${index}-${line.isNew}`"
  :class="{ 'new-line': line.isNew }"
  :x1="line.x1" :y1="line.y1"
  :x2="line.x2" :y2="line.y2"
  stroke="#6366f1"
  stroke-width="3"
  stroke-linecap="round"
/>
    </svg>

    <!-- Master Branch -->
    <div class="branch-column">
      <div class="branch-header">Master</div>
      <div class="action-buttons">
        <button @click="createHotfix" class="warning">ğŸš‘ Criar Hotfix</button>
      </div>
      <div class="commit-list">
        <div
          v-for="(commit, idx) in branchData.master"
          :key="commit.id"
          class="commit-bubble"
          :class="{ latest: idx === branchData.master.length - 1 }"
          :data-branch="'master'"
          :data-commit-id="commit.id"
        >
          {{ commit.label }}
        </div>
      </div>
    </div>

    <!-- Hotfix Branch -->
    <div v-if="showHotfix" class="branch-column">
      <div class="branch-header">Hotfix</div>
      <div class="action-buttons">
        <button @click="commitAction('hotfix')">ğŸ“ Commit</button>
        <button @click="mergeHotfix" class="success">ğŸ”€ Merge</button>
        <button @click="deleteBranch('hotfix')" class="delete">ğŸ—‘ï¸ Excluir</button>
      </div>
      <div class="commit-list">
        <div
          v-for="(commit, idx) in branchData.hotfix"
          :key="commit.id"
          class="commit-bubble"
          :class="{ latest: idx === branchData.hotfix.length - 1 }"
          :data-branch="'hotfix'"
          :data-commit-id="commit.id"
        >
          {{ commit.label }}
        </div>
      </div>
    </div>

    <!-- Staging Branch -->
    <div class="branch-column">
      <div class="branch-header">Staging</div>
      <div class="action-buttons">
        <button @click="commitAction('staging')">ğŸ“ Commit</button>
        <button @click="autoTestStaging" class="success">ğŸ§ª Testes Automatizados</button>
        <button @click="qaTestStaging" class="success">ğŸ§ª QA Testar</button>
        <button @click="mergeStaging" class="success">ğŸ”€ Merge</button>
      </div>
      <div class="commit-list">
        <div
          v-for="(commit, idx) in branchData.staging"
          :key="commit.id"
          class="commit-bubble"
          :class="{ latest: idx === branchData.staging.length - 1 }"
          :data-branch="'staging'"
          :data-commit-id="commit.id"
        >
          {{ commit.label }}
        </div>
      </div>
    </div>

    <!-- Release Branch -->
    <div v-if="showRelease" class="branch-column">
      <div class="branch-header">Release</div>
      <div class="action-buttons">
        <button @click="commitAction('release')">ğŸ“ Commit</button>
        <button @click="mergeRelease" class="success">ğŸ”€ Merge</button>
        <button @click="deleteBranch('release')" class="delete">ğŸ—‘ï¸ Excluir</button>
      </div>
      <div class="commit-list">
        <div
          v-for="(commit, idx) in branchData.release"
          :key="commit.id"
          class="commit-bubble"
          :class="{ latest: idx === branchData.release.length - 1 }"
          :data-branch="'release'"
          :data-commit-id="commit.id"
        >
          {{ commit.label }}
        </div>
      </div>
    </div>

    <!-- Develop Branch -->
    <div class="branch-column">
      <div class="branch-header">Develop</div>
      <div class="action-buttons">
        <button @click="autoTest" class="success">ğŸ§ª Testes Automatizados</button>
        <button @click="qaTestFeature" class="success">ğŸ§ª QA Testar</button>
        <button @click="createRelease" class="warning">ğŸš€ Criar Release</button>
        <button @click="createFeature" class="warning">âš™ï¸ Criar Feature</button>
      </div>
      <div class="commit-list">
        <div
          v-for="(commit, idx) in branchData.develop"
          :key="commit.id"
          class="commit-bubble"
          :class="{ latest: idx === branchData.develop.length - 1 }"
          :data-branch="'develop'"
          :data-commit-id="commit.id"
        >
          {{ commit.label }}
        </div>
      </div>
    </div>

    <!-- Feature Branch -->
    <div v-if="showFeature" class="branch-column">
      <div class="branch-header">Feature</div>
      <div class="action-buttons">
        <button @click="commitAction('feature')">ğŸ“ Commit</button>
        <button @click="testFeature" class="success">ğŸ§ª Testar</button>
        <button @click="mergeFeature" class="success">ğŸ”€ Merge</button>
        <button @click="deleteBranch('feature')" class="delete">ğŸ—‘ï¸ Excluir</button>
      </div>
      <div class="commit-list">
        <div
                v-for="(commit, idx) in branchData.feature"
                :key="commit.id"
                class="commit-bubble"
                :class="{
                  latest: idx === branchData.feature.length - 1,
                  'feature-flag': commit.featureFlag
                }"
                :data-branch="'feature'"
                :data-commit-id="commit.id"
        >
          {{ commit.label }}
        </div>
      </div>
    </div>
  </div>

  <div class="log-container">
    <h3>ğŸ“œ HistÃ³rico de AÃ§Ãµes</h3>
    <div v-for="(entry, idx) in logs" :key="idx" class="log-entry">
      <span class="log-timestamp">{{ entry.timestamp }}</span>
      <span class="log-content">{{ entry.message }}</span>
    </div>
  </div>
</div>

<script>
new Vue({
  el: '#app',
  data() {
    return {
      branchData: { master: [], staging: [], develop: [], release: [], feature: [], hotfix: [] },
      showHotfix: false,
      showRelease: false,
      showFeature: false,
      lines: [],
      svgWidth: 5000,
      svgHeight: 5000,
      actionCounter: 0,
      logs: []
    }
  },
  mounted() {
    this.commitAction('master');
    this.commitAction('staging');
    this.commitAction('develop');
  },
  methods: {
    createCommit(branchName, logIt = true) {
      const list = this.branchData[branchName];
      const idx = list.length;
      const newCommit = {
        id: Date.now() + Math.random(),
        label: branchName.charAt(0).toUpperCase() + (idx + 1),
        featureFlag: branchName === 'feature' // Adicione esta linha
      };
      list.push(newCommit);

      if (idx > 0) {
        const fromId = list[idx - 1].id;
        const toId = newCommit.id;
        this.lines.push({
          fromBranch: branchName, fromId,
          toBranch: branchName, toId,
          x1: 0, y1: 0, x2: 0, y2: 0,
          isNew: true
        });
      }

      if (logIt) this.addLog(`Commit na branch ${branchName.toUpperCase()}`);

      this.$nextTick(() => {
        this.updateLinePositions();
        this.animateCommit(newCommit.id);
      });

      return newCommit;
    },

    animateCommit(commitId) {
      const commitEl = document.querySelector(`[data-commit-id="${commitId}"]`);
      if (commitEl) {
        commitEl.style.animation = 'pulse 0.5s ease';
        setTimeout(() => commitEl.style.animation = '', 500);
      }
    },

    commitAction(branch) {
      this.actionCounter++;
      const newCommit = this.createCommit(branch, true);
      if (branch === 'feature' && newCommit.featureFlag) {
        this.addLog(`ğŸš© Commit na FEATURE com Feature Flag`);
      }
    },

    createHotfix() {
      if (!this.showHotfix) {
        const lastMasterCommit = this.branchData.master[this.branchData.master.length - 1];
        this.showHotfix = true;
        this.actionCounter++;
        const newHotfixCommit = this.createCommit('hotfix', true);
        
        // ConexÃ£o com Master
        if (lastMasterCommit) {
          this.lines.push({
            fromBranch: 'master',
            fromId: lastMasterCommit.id,
            toBranch: 'hotfix',
            toId: newHotfixCommit.id,
            x1: 0, y1: 0, x2: 0, y2: 0,
            isNew: true
          });
        }
        
        this.addLog(`ğŸš‘ Criou a branch HOTFIX`);
      }
    },

    mergeStaging() {
      const stgList = this.branchData.staging;
      if (!stgList.length) return;

      const lastStgCommit = stgList[stgList.length - 1];
      const newMaster = this.createCommit('master', false);
      const newDev = this.createCommit('develop', false);
      
      this.lines.push(
        { fromBranch: 'staging', fromId: lastStgCommit.id, toBranch: 'master', toId: newMaster.id, x1:0,y1:0,x2:0,y2:0, isNew: true },
        { fromBranch: 'staging', fromId: lastStgCommit.id, toBranch: 'develop', toId: newDev.id, x1:0,y1:0,x2:0,y2:0, isNew: true }
      );

      this.actionCounter++;
      this.addLog(`ğŸ”€ Merge STAGING -> MASTER & DEVELOP`);
      this.$nextTick(() => this.updateLinePositions());
    },

    // Dentro do mÃ©todo createRelease
    createRelease() {
      if (!this.showRelease) {
        const lastDevelopCommit = this.branchData.develop[this.branchData.develop.length - 1];
        this.showRelease = true;
        this.actionCounter++;
        const newReleaseCommit = this.createCommit('release', true);
        
        // Adicionar linha de conexÃ£o com develop
        if (lastDevelopCommit) {
          this.lines.push({
            fromBranch: 'develop',
            fromId: lastDevelopCommit.id,
            toBranch: 'release',
            toId: newReleaseCommit.id,
            x1: 0, y1: 0, x2: 0, y2: 0,
            isNew: true
          });
        }
        
        this.addLog(`ğŸš€ Criou a branch RELEASE`);
      }
    },

    createFeature() {
      if (!this.showFeature) {
        const lastDevelopCommit = this.branchData.develop[this.branchData.develop.length - 1];
        this.showFeature = true;
        this.actionCounter++;
        const newFeatureCommit = this.createCommit('feature', true);
        
        // ConexÃ£o com Develop
        if (lastDevelopCommit) {
          this.lines.push({
            fromBranch: 'develop',
            fromId: lastDevelopCommit.id,
            toBranch: 'feature',
            toId: newFeatureCommit.id,
            x1: 0, y1: 0, x2: 0, y2: 0,
            isNew: true
          });
        }
        
        this.addLog(`âš™ï¸ Criou a branch FEATURE`);
      }
    },

    mergeRelease() {
      const relList = this.branchData.release;
      if (!relList.length) return;

      const lastRel = relList[relList.length - 1];
      const newStaging = this.createCommit('staging', false);
      const newDev = this.createCommit('develop', false);
      
      this.lines.push(
        { fromBranch: 'release', fromId: lastRel.id, toBranch: 'staging', toId: newStaging.id, x1:0,y1:0,x2:0,y2:0, isNew: true },
        { fromBranch: 'release', fromId: lastRel.id, toBranch: 'develop', toId: newDev.id, x1:0,y1:0,x2:0,y2:0, isNew: true }
      );

      this.actionCounter++;
      this.addLog(`ğŸ”€ Merge RELEASE -> STAGING & DEVELOP`);
      this.$nextTick(() => this.updateLinePositions());
    },

    testFeature() {
      this.actionCounter++;
      this.addLog(`ğŸ§ª Testando a branch FEATURE`);
    },

    qaTestFeature() {
      this.actionCounter++;
      this.addLog(`ğŸ§ª QA Testando a branch DEVELOP`);
    },

    qaTestStaging() {
      this.actionCounter++;
      this.addLog(`ğŸ§ª QA Testando a branch STAGING`);
    },

    autoTest() {
      this.actionCounter++;
      this.addLog(`ğŸ§ª DEV rodando testes automatizados na branch DEVELOP`);
    },

    autoTestStaging() {
      this.actionCounter++;
      this.addLog(`ğŸ§ª DEV rodando testes automatizados na branch STAGING`);
    },

    mergeFeature() {
      const featList = this.branchData.feature;
      if (!featList.length) return;

      const lastFeat = featList[featList.length - 1];
      const newDev = this.createCommit('develop', false);
      
      this.lines.push({
        fromBranch: 'feature', fromId: lastFeat.id,
        toBranch: 'develop', toId: newDev.id,
        x1: 0, y1: 0, x2: 0, y2: 0,
        isNew: true
      });

      this.actionCounter++;
      this.addLog(`ğŸ”€ Merge FEATURE -> DEVELOP`);
      this.$nextTick(() => this.updateLinePositions());
    },

    mergeHotfix() {
      const hfxList = this.branchData.hotfix;
      if (!hfxList.length) return;

      const lastHfx = hfxList[hfxList.length - 1];
      const newMst = this.createCommit('master', false);
      const newStg = this.createCommit('staging', false);
      const newDev = this.createCommit('develop', false);
      
      this.lines.push(
        { fromBranch: 'hotfix', fromId: lastHfx.id, toBranch: 'master', toId: newMst.id, x1:0,y1:0,x2:0,y2:0, isNew: true },
        { fromBranch: 'hotfix', fromId: lastHfx.id, toBranch: 'staging', toId: newStg.id, x1:0,y1:0,x2:0,y2:0, isNew: true },
        { fromBranch: 'hotfix', fromId: lastHfx.id, toBranch: 'develop', toId: newDev.id, x1:0,y1:0,x2:0,y2:0, isNew: true }
      );

      this.actionCounter++;
      this.addLog(`ğŸ”€ Merge HOTFIX -> MASTER, STAGING & DEVELOP`);
      this.$nextTick(() => this.updateLinePositions());
    },

    deleteBranch(branchName) {
      if (['hotfix', 'release', 'feature'].includes(branchName)) {
        this[`show${branchName.charAt(0).toUpperCase() + branchName.slice(1)}`] = false;
        this.branchData[branchName] = [];
        this.removeLinesFromBranch(branchName);
        this.actionCounter++;
        this.addLog(`ğŸ—‘ï¸ Excluiu a branch ${branchName.toUpperCase()}`);
        this.$nextTick(() => this.updateLinePositions());
      }
    },

    removeLinesFromBranch(branchName) {
      this.lines = this.lines.filter(line => 
        line.fromBranch !== branchName && line.toBranch !== branchName
      );
    },

    updateLinePositions() {
      if (!this.$refs.container) return;
      const containerRect = this.$refs.container.getBoundingClientRect();

      this.lines.forEach(line => {
        const fromEl = document.querySelector(
          `[data-branch="${line.fromBranch}"][data-commit-id="${line.fromId}"]`
        );
        const toEl = document.querySelector(
          `[data-branch="${line.toBranch}"][data-commit-id="${line.toId}"]`
        );

        if (fromEl && toEl) {
          const fromRect = fromEl.getBoundingClientRect();
          const toRect = toEl.getBoundingClientRect();
          
          line.x1 = fromRect.left - containerRect.left + fromRect.width/2;
          line.y1 = fromRect.top - containerRect.top + fromRect.height/2;
          line.x2 = toRect.left - containerRect.left + toRect.width/2;
          line.y2 = toRect.top - containerRect.top + toRect.height/2;
        }
      });
      
      this.lines = [...this.lines];
      this.markLineAsOld();
    },

    markLineAsOld() {
      setTimeout(() => {
        this.lines = this.lines.map(line => ({ ...line, isNew: false }));
      }, 3100); // Tempo igual Ã  duraÃ§Ã£o da animaÃ§Ã£o
    },


    addLog(msg) {
      this.logs.unshift({
        timestamp: new Date().toLocaleTimeString(),
        message: `[${this.actionCounter}] - ${msg}`
      });
      
      if (msg.includes('Merge')) {
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 },
          colors: ['#6366f1', '#3b82f6', '#22c55e']
        });
      }
      if (msg.includes('Criou')) {
        confetti({
          particleCount: 30,
          spread: 50,
          origin: { y: 0.6 },
          colors: ['#eab308']
        });
      }
    }
  }
});
</script>
</body>
</html>